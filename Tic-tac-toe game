#include <iostream>
#include <vector>
#include <string>

using namespace std;

void printBoard(const vector<char>& board) {
    cout << "\n";
    for (int i = 0; i < 9; i += 3) {
        cout << " " << board[i] << " | " << board[i+1] << " | " << board[i+2] << "\n";
        if (i < 6) cout << "---+---+---\n";
    }
    cout << "\n";
}

bool isWinner(const vector<char>& b, char p) {
    // 8 winning lines
    const int wins[8][3] = {
        {0,1,2}, {3,4,5}, {6,7,8}, // rows
        {0,3,6}, {1,4,7}, {2,5,8}, // cols
        {0,4,8}, {2,4,6}           // diags
    };
    for (auto &w : wins) {
        if (b[w[0]] == p && b[w[1]] == p && b[w[2]] == p) return true;
    }
    return false;
}

bool boardFull(const vector<char>& b) {
    for (char c : b) if (c == ' ') return false;
    return true;
}

int getMove(const vector<char>& board, char player) {
    while (true) {
        cout << "Player " << player << ", enter your move (1-9): ";
        string line;
        if (!getline(cin, line)) return -1; // EOF or error
        if (line.empty()) continue;

        // try to parse integer
        int pos = 0;
        try {
            pos = stoi(line);
        } catch (...) {
            cout << "  Invalid input. Enter a number between 1 and 9.\n";
            continue;
        }
        if (pos < 1 || pos > 9) {
            cout << "  Number must be between 1 and 9.\n";
            continue;
        }
        int idx = pos - 1;
        if (board[idx] != ' ') {
            cout << "  Cell already taken. Choose a different cell.\n";
            continue;
        }
        return idx;
    }
}

int main() {
    cout << "Tic-Tac-Toe (two players)\n";
    cout << "Cells are numbered 1 to 9 as follows:\n";
    cout << " 1 | 2 | 3\n";
    cout << "---+---+---\n";
    cout << " 4 | 5 | 6\n";
    cout << "---+---+---\n";
    cout << " 7 | 8 | 9\n\n";

    while (true) {
        vector<char> board(9, ' ');
        char current = 'X';
        bool gameOver = false;

        while (!gameOver) {
            printBoard(board);
            int move = getMove(board, current);
            if (move < 0) {
                cout << "Input error. Exiting.\n";
                return 0;
            }
            board[move] = current;

            if (isWinner(board, current)) {
                printBoard(board);
                cout << "Player " << current << " wins! Congratulations!\n";
                gameOver = true;
                continue;
            }

            if (boardFull(board)) {
                printBoard(board);
                cout << "It's a draw!\n";
                gameOver = true;
                continue;
            }

            // switch player
            current = (current == 'X') ? 'O' : 'X';
        }

        cout << "Play again? (y/n): ";
        string ans;
        if (!getline(cin, ans)) break;
        if (ans.empty() || (ans[0] != 'y' && ans[0] != 'Y')) {
            cout << "Thanks for playing!\n";
            break;
        }
        cout << "\nStarting a new game...\n\n";
    }

    return 0;
}
